\documentclass[parskip=full,11pt]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[german]{babel}
\usepackage[useregional]{datetime2}
\usepackage[pdfborderstyle={/S/U/W 0}]{hyperref}
\usepackage[nameinlink]{cleveref}
\usepackage[section]{placeins}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{csquotes}
\usepackage{amsmath} % for $\text{}$
\usepackage{entwurf}
\usepackage{enumitem}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
\usepackage{listings}
\usepackage{bera}

\setlist{nosep}

\newcommand\urlpart[2]{$\underbrace{\text{\texttt{#1}}}{\text{#2}}$}
\raggedbottom
\crefname{figure}{Abb}{Abb}

\newcommand\producttitle{treff.}
\hypersetup{
	pdftitle={Entwurf: \producttitle},
	bookmarks=true,
}

% section numbers in margins:
\renewcommand\sectionlinesformat[4]{\makebox[0pt][r]{#3}#4}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}
\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\lstdefinelanguage{norm}{
    basicstyle=\normalfont\ttfamily,
    escapeinside={(*}{*)},
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
    language=Python,
    basicstyle=\normalfont\ttfamily,
    otherkeywords={self},
    keywordstyle=\ttb\color{deepblue},
    emph={normalize},
    emphstyle=\ttb\color{deepred},
    stringstyle=\color{deepgreen},
    frame=tb,
    showstringspaces=false,
    backgroundcolor=\color{background},
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    escapeinside={(*}{*)},
}}


% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
\pythonstyle
\lstinputlisting[#1]{#2}}}

% header & footer
\usepackage{scrlayer-scrpage}
%\lofoot{\today}
%\refoot{\today}
\pagestyle{scrheadings}

\title{\includegraphics[width = 80mm]{images/logo_crop.png}}
\subtitle{\huge Entwurf}
\author{Lukas Dippon
        \and Jens Kienle
        \and Matthias Noll
        \and Fabian Röpke
        \and Tim Schmidt
        \and Simon Vögele}

\begin{document}

\maketitle
\thispagestyle{empty} % removed page number from title

\pagebreak
\tableofcontents

%%%%%%%%%%%%%%%%%%%
\pagebreak
\section{Einleitung}

\subsection{Client-Server-Architektur}
Für die App \enquote{treff.} soll eine Klient-Server-Architektur verwendet werden,
um die Interaktion mehrerer Nutzer zu realisieren.
Hierbei stellen die Geräte der Nutzer die Klienten dar und der Server
fungiert als Vermittler und Datenbank.
Hierbei werden leicht bedienbare Kommunikationsschnittstellen verwendet.
Dadurch wird ebenfalls eine starke Kopplung zwischen den in diesem Dokument
vorgestellten Implementierungen für Klient und Server vermieden.
Außerdem ermöglicht dies Kompatibilität mit alternativen Implementierungen
von sowohl Klienten als auch Servern.

\subsection{Funktion - Client}
Der Klient speichert für den Nutzer relevante Daten in einer lokalen Datenbank ab.
Diese können vom Nutzer eingesehen werden.
Anfragen des Nutzers werden in Form von Befehlen an den Server weitergegeben (\ref{command}).
Diverse Daten wie beispielsweise GPS-Standort oder Chatnachrichten werden
dabei als Parameter der Befehle an den Server übergeben.

\subsection{Funktion - Server}
Der Server speichert die Daten der Nutzer in einer zentralen Datenbank,
nimmt Befehle der Klienten entgegen und verändert gegebenenfalls die Datensätze.
Bei Veränderung von Daten werden alle betroffenen Klienten darüber informiert,
welche daraufhin ihre lokalen Datensätze aktualisieren können.

%%%%%%%%%%%%%%%%%%%%
\pagebreak
\section{Aufbau und internes Verhalten - Client}

\subsection{Aufbau}
% Aufteilung in GUI und Datenverarbeitung (Fließtext)
% Ihre Funktionen

\subsection{Bestandteile der GUI}
% Strukturierung der GUI durch Activities und deren Aufteilung in Fragments,
%	sowie das Zusammenspiel der Activities (Fließtext und UML-Klassendiagramme,
% ggf Sequenzdiagramme)

\subsection{Bestandteile Datenverarbeitung}
% Aufteilung der Funktionalitäten auf seperate Klassen,
% sowie deren Zusammenspiel (Fließtext und UML-Klassendiagramme, ggf Sequenzdiagramme)

\subsection{Kommunikation von GUI und Datenverarbeitung}
% Zusammenspiel von GUI und Datenverarbeitung
% (Fließtext und UML-Klassendiagramme, ggf Sequenzdiagramme)

\subsection{JavaDoc}

%%%%%%%%%%%%%%%%%%%%%%
\pagebreak
\section{Aufbau und internes Verhalten - Server}

\subsection{Aufbau}
% Aufteilung der Funktionalitäten auf seperate Klassen;
% Zusammenspiel dieser Klassen (Fließtext und UML-Klassendiagramme,
% ggf Sequenzdiagramme)

\subsection{Bestandteile des Servers}
% Aufbau und genaue Funktionalität dieser Klassen
% [z.B. Datenbank, Schnittstelle zum Client]
% (Fließtext und UML-Klassendiagramme, ggf Sequenzdiagramme)

\subsection{JavaDoc}

%%%%%%%%%%%%%%%%%%%%%%
\pagebreak
\section{Kommunikation zwischen Client und Server}
% Zusammenspiel von Client und Server
% (Fließtext und Sequenzdiagram, ggf UML-Klassendiagram)
% TODO: JSON verlinken / footnote
% TODO: Alphabet und Escapes genau festlegen
Client und Server kommunizieren mittels Nachrichten im JSON-Format.
Die oberste Ebene jeder Nachricht bildet ein einzelnes JSON-Objekt.
Parameter, Rückgabewerte und Fehlercodes werden als Eigenschaften dieses
Objektes kodiert.
Eine Anfrage beinhaltet immer mindestens eine Eigenschaft mit dem Schlüssel
\textbf{cmd}.
Die Namen der im folgenden definierten Befehle sind exakt die Werte, die bei
Kodierung als Nachricht den Wert der \textbf{cmd}-Eigenschaft bilden müssen.
Diese Namen sind als Zeichenketten zu kodieren.
\\Wird während der Ausführung des Befehls ein Fehler gefunden, möglicherweise
durch übermittelte Parameter bedingt, wird nur ein Fehlercode mit dem Schlüssel
\textbf{error} zurückgegeben. Die Bedeutung der Fehlercodes wird ebenfalls im
folgenden definiert.

\subsection{Befehle}\label{sec:commands}

\apiErrorNew{token-invalid}{10}{Authentifizierungtoken ungültig}
\apiErrorNew{cred-wrong}{20}{Nutzername/Passwort-Kombination ungültig}
\apiErrorNew{group-id-invalid}{30}{Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe}
\apiErrorNew{username-invalid}{40}{Nutzername ungültig}
\apiErrorNew{event-id-invalid}{50}{Verabredungs-Identifikationsnummer ungültig}
\apiErrorNew{poll-id-invalid}{60}{Abstimmungs-Identifikationsnummer ungültig}
\apiErrorNew{user-id-invalid}{70}{Mindestens eine Benutzerkonto-Identifikationsnummer ist ungültig}
\apiErrorNew{no-user-invited}{80}{Kein Benutzerkonto eingeladen, das nicht das eigene ist}
\apiErrorNew{time-end-in-past}{90}{Mindestens ein Endzeitpunkt liegt in der Vergangenheit}
\apiErrorNew{time-end-start-conflict}{100}{Mindestens ein Endzeitpunkt liegt nicht
nach dem dazugehörigen Startzeitpunkt}
\apiErrorNew{no-permission-event-create}{110}{Das Benutzerkonto besitzt nicht die nötigen Rechte,
um in der angegebenen Gruppe Verabredungen erstellen zu können}
\apiErrorNew{no-permission-poll-create}{120}{Das Benutzerkonto besitzt nicht die nötigen Rechte,
um in der angegebenen Gruppe Abstimmung erstellen zu können}
\apiErrorNew{no-permission-poll-edit}{130}{Das Benutzerkonto besitzt nicht die nötigen Rechte,
um die Abstimmung zu editieren}

Bis auf dem \textbf{login}-Befehl erfordert jeder Befehl folgenden
Parameter:\\
\apiArgument{token/Authentifizierungtoken{,} welches beim Einloggen in das
Benutzerkonto vom Server zurückgegeben wurde}
\par\par Ist das übermittelte Token ungültig, wird der Befehl nicht
ausgeführt und folgender Fehlercode zurückgegeben:\\
\apiErrorPrint{token-invalid}

\apiCommandB{login}
{Einloggen in ein Nutzerkonto}
{user/Benutzername des Kontos,
pass/Passwort des Kontos}
{token/Authentifizierungstoken{,} welches in weiteren Befehlen
als Eingabe verlangt wird}
{cred-wrong}

\apiCommandB{list-groups}
{Auflisten der Gruppen, in denen das Benutzerkonto Mitglied ist}
{---/Keine weiteren Parameter}
{groups/Ein Array an oberflächlich beschriebenen Gruppen (siehe
Kapitel \ref{sec:groupdesc})}
{}

\apiCommandB{get-group-details}
{Abrufen von Details einer Gruppe, in denen das Benutzerkonto Mitglied ist}
{id/Identifikationsnummer der Gruppe}
{\dots/Eine ausführliche Beschreibung der Gruppe{,} die zu der angegebenen
Identifikationsnummer gehört (siehe \ref{sec:groupdesc})}
{group-id-invalid}

\apiCommandB{get-user-id}
{Abrufen der Idenfikationsnummer eines anderen Benutzekontos durch Übergeben
des Benutzernamens}
{user/Benutzername des Benutzerkontos}
{\dots/Eine Beschreibung eines Benutzerkontos{,} das zu dem angegebenen
Benutzernamen gehört (siehe \ref{sec:accountdesc})}
{username-invalid}

% TODO: Definiere „aktive Verabredung“
\apiCommandB{get-event-details}
{Abrufen von Details einer aktiven Verabredung, die in einer Gruppe erstellt
wurde, in der das Benutzerkonto Mitglied ist}
{id/Identifikationsnummer der Verabredung,
group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
wurde}
{\dots/Eine ausführliche Beschreibung der Verabredung{,} die zu der angegebenen
Identifikationsnummer gehört (siehe \ref{sec:eventdesc})}
{group-id-invalid,event-id-invalid}

\apiCommandB{get-poll-details}
{Abrufen von Details einer aktiven Abstimmung, die in einer Gruppe erstellt
wurde, in der das Benutzerkonto Mitglied ist}
{id/Identifikationsnummer der Abstimmung,
group-id/Identifikationsnummer der Gruppe{,} in der die Abstimmung erstellt
wurde}
{\dots/Eine ausführliche Beschreibung der Abstimmung{,} die zu der angegebenen
Identifikationsnummer gehört (siehe \ref{sec:polldesc})}
{group-id-invalid,poll-id-invalid}

\apiCommandB{create-group}
{Erstellen einer Gruppe}
{name/Name der Gruppe,
members/Array an Identifikationsnummern aller Benutzerkonten{,} die nach
Erstellung der Gruppe dieser hinzugefügt werden sollen.
Die Identifikationsnummer des eigenen Benutzerkontos muss nicht angegeben
werden.
Falls dennoch vorhanden{,} wird diese ignoriert.
Das Array muss mindestens eine gültige Identifikationsnummer beinhalten{,} die
nicht die eigene ist.}
{id/Eindeutige Identifikationsnummer der Gruppe{,} mit der diese in
weiteren Befehlen referenziert werden kann}
{user-id-invalid,no-user-invited}

\apiCommandB{create-event}
{Erstellen einer Verabredung in einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
werden soll,
title/Titel der Verabredung,
time-start/Startzeitpunkt (Angabe in Unixzeit%
\footnote{Siehe \enquote{Unixzeit}, Version 172239469, Wikipedia,\\
\url{https://de.wikipedia.org/w/index.php?title=Unixzeit&oldid=172239469}}),
time-end/Endzeitpunkt (Angabe in Unixzeit),
latitude/Breitengrad{,} auf dem die Verabredung stattfindet (Angabe als
Dezimalgrad),
longitude/Längengrad{,} auf dem die Verabredung stattfindet (Angabe als
Dezimalgrad)}
{id/Eindeutige Identifikationsnummer der Verabredung{,} mit der diese in weiteren
Befehlen referenziert werden kann}
{group-id-invalid,time-end-in-past,time-end-start-conflict,no-permission-event-create}

\apiCommandB{create-poll}
{Erstellen einer Abstimmung in einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Abstimmung erstellt
werden soll,
question/Frage{,} über dessen Antwort abgestimmt wird,
multi-choice/Boolscher Wert{,} der angibt{,} ob ein Nutzer für mehrere
Optionen stimmen kann,
options/Array an Beschreibungen von Abstimmungsoptionen{,} die nach der
Erstellung der Abstimmung hinzugefügt werden sollen}
{id/Eindeutige Identifikationsnummer der Abstimmung{,} mit der diese in
weiteren Befehlen referenziert werden kann,
option-ids/Array an Identifikationsnummern der Abstimmungsoptionen. Die
Reihenfolge dieser IDs entspricht genau der Reihenfolge der angegebenen
Abstimmungsoptionen.}
{group-id-invalid,time-end-in-past,time-end-start-conflict,no-permission-poll-create}

\apiCommandB{add-poll-option}
{Hinzufügen einer Abstimmungsoption in einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Abstimmung erstellt
wurde,
poll-id/Identifikationsnummer der Abstimmung{,} zu der die Abstimmungsoption
hinzugefügt werden soll,
latitude/Breitengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
longitude/Längengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
time-start/Vorgeschlagener Startzeitpunkt (Angabe in Unixzeit),
time-end/Vorgeschlagener Endzeitpunkt (Angabe in Unixzeit)}
{id/Eindeutige Identifikationsnummer der Abstimmungsoption{,} mit der diese in
weiteren Befehlen referenziert werden kann}
{group-id-invalid,poll-id-invalid,time-end-in-past,time-end-start-conflict,no-permission-poll-edit}

\apiCommand{edit-group-name}
{Editieren des Namens einer Gruppe, in der das Benutzerkonto Mitglied ist}
{id/Eindeutige Identifikationsnummer der Gruppe,
name/Neuer name der Gruppe}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
1100/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um den Gruppennamen
zu editieren}

\apiCommand{add-group-members}
{Hinzufügen eines oder mehrerer Benutzerkonten zu einer Gruppe, in der das
Benutzerkonto Mitglied ist}
{id/Eindeutige Identifikationsnummer der Gruppe,
members/Array an Identifikationsnummern aller Benutzerkonten{,} die der Gruppe
hinzugefügt werden sollen.
Es dürfen keine Identifikationsnummern von Benutzerkonten angegeben werden{,}
die bereits Teil der Gruppe ist.
Insbesondere darf nicht die Identifikationsnummer des eigenen Benutzerkontos
angegeben werden.}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
700/Mindestens eine Benutzerkonto-Identifikationsnummer ist ungültig,
1200/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Liste an
Gruppenmitgliedern zu editieren,
1210/Mindestens eine Identifikationsnummer gehört zu einem Benutzerkonto{,}
welches bereits Teil der Gruppe ist}

\apiCommand{remove-group-members}
{Entfernen eines oder mehrerer Benutzerkonten von einer Gruppe, in der das
Benutzerkonto Mitglied ist}
{id/Eindeutige Identifikationsnummer der Gruppe,
members/Array an Identifikationsnummern aller Benutzerkonten{,} die aus der
Gruppe entfernt werden sollen.
Es dürfen keine Identifikationsnummern von Benutzerkonten angegeben werden{,}
die nicht Teil der Gruppe sind.
Es darf die Identifikationsnummer des eigenen Benutzerkontos angegeben werden.
Dies führt wie erwartet dazu{,} dass das eigene Benutzerkonto den weiteren
Zugriff auf die Gruppe verliert.
Werden durch diesen Befehl alle Mitglieder einer Gruppe entfernt{,} wird die
Gruppe gelöscht.}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
700/Mindestens eine Benutzerkonto-Identifikationsnummer ist ungültig,
1200/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Liste an
Gruppenmitgliedern zu editieren,
1300/Mindestens eine Identifikationsnummer gehört zu einem Benutzerkonto{,}
welches nicht Teil der Gruppe ist}

\apiCommand{edit-event}
{Editieren einer Verabredung in einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
wurde,
id/Identifikationsnummer der Verabredung,
\dots/Alle Eigenschaften{,} mit Ausnahme des Teilnehmerarrays und der
Identifikationsnummer{,} die überschrieben werden sollen.
Die Schlüssel entsprechen denen einer ausführlichen Verabredungsbeschreibung.}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
800/Endzeitpunkt liegt in der Vergangenheit,
810/Endzeitpunkt liegt nicht nach dem Startzeitpunkt,
1400/Verabredungs-Identifikationsnummer ungültig,
1410/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Verabredung
editieren zu können}

\apiCommand{remove-event}
{Entfernen einer Verabredung aus einer Gruppe, in der das Benutzerkonto
Mitglied ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
wurde,
id/Identifikationsnummer der Verabredung}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
1400/Verabredungs-Identifikationsnummer ungültig,
1410/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Verabredung
editieren zu können}

\apiCommand{remove-poll}
{Entfernen einer Abstimmung aus einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
wurde,
id/Identifikationsnummer der Abstimmung}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
600/Abstimmungs-Identifikationsnummer ungültig,
1000/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Abstimmung zu
editieren} % TODO: editieren vs. editieren zu können

\apiCommand{edit-poll}
{Editieren einer Abstimmung in einer Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Verabredung erstellt
wurde,
id/Identifikationsnummer der Abstimmung,
\dots/Alle Eigenschaften{,} mit Ausnahme des Abstimmungsoptionsarrays und der
Identifikationsnummer{,} die überschrieben werden sollen.
Die Schlüssel entsprechen denen einer ausführlichen Abstimmungsbeschreibung.}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
600/Abstimmungs-Identifikationsnummer ungültig,
1000/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Abstimmung zu
editieren}

% TODO: „Wählerarray“ besser formulieren
\apiCommand{edit-poll-option}
{Editieren einer Abstimmungsoption in einer Gruppe, in der das Benutzerkonto
Mitglied ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Abstimmung erstellt
wurde,
poll-id/Identifikationsnummer der Abstimmung,
id/Identifikationsnummer der Abstimmungsoption,
\dots/Alle Eigenschaften{,} mit Ausnahme des Wählerarrays und der
Identifikationsnummer{,} die überschrieben werden sollen.
Die Schlüssel entsprechen denen einer ausführlichen Abstimmungsbeschreibung.}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
600/Abstimmungs-Identifikationsnummer ungültig,
1000/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Abstimmung zu
editieren}

\apiCommand{remove-poll-option}
{Entfernen einer Abstimmungsoption in einer Gruppe, in der das Benutzerkonto
Mitglied ist}
{group-id/Identifikationsnummer der Gruppe{,} in der die Abstimmung erstellt
wurde,
poll-id/Identifikationsnummer der Abstimmung,
id/Identifikationsnummer der Abstimmungsoption}
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe,
600/Abstimmungs-Identifikationsnummer ungültig,
1000/Das Benutzerkonto besitzt nicht die nötigen Rechte{,} um die Abstimmung zu
editieren}

\apiCommand{send-chat-message}
{Senden einer Textnachricht an eine Gruppe, in der das Benutzerkonto Mitglied
ist}
{group-id/Identifikationsnummer der Gruppe
message/Textnachricht} % TODO: Länge beschränken (vllt. auch Gruppengröße etc)
{---/Leeres JSON-Objekt bei Erfolg}
{300/Gruppen-Identifikationsnummer ungültig oder Benutzerkonto nicht Teil der
Gruppe}

\apiCommand{add-contact}
{Hinzufügen eines anderen Benutzerkontos zur eigenen Kontaktliste.
Fügt ebenfalls das eigene Benutzerkonto zur Kontaktliste des anderen
Benutzerkontos hinzu.
Dies schlägt fehl, wenn eines der zwei Benutzerkonten das andere blockiert.}
{id/Identifikationsnummer des anderen Benutzerkontos}
{---/Leeres JSON-Objekt bei Erfolg}
{2100/Benutzerkonto-Identifikationsnummer ungültig,
2110/Das eigenes Benutzerkonto wird vom angegeben Benutzerkonto blockiert,
2120/Das eigene Benutzerkonto blockiert das angegebene Benutzerkonto}

\apiCommand{remove-contact}
{Entfernen eines anderen Benutzerkontos von der eigenen Kontaktliste.
Entfernt ebenfalls das eigene Benutzerkonto von der Kontaktliste des anderen.}
{id/Identifikationsnummer des anderen Benutzerkontos}
{---/Leeres JSON-Objekt bei Erfolg}
{2100/Benutzerkonto-Identifikationsnummer ungültig,
2210/Das angegebene Benutzerkonto ist nicht in der eigenen Kontaktliste}

\apiCommand{block-account}
{Blockiert das angegebene Benutzerkonto.
Bis dies aufgehoben wird, können das eigene und das angegebene
Benutzerkonto sich nicht gegenseitig zur ihrer Kontaktliste hinzufügen.
Sind die beiden Benutzerkonten bereits Kontakte, werden diese vorher aus der
Kontaktliste des jeweils anderen Benutzerkontos entfernt.}
{id/Identifikationsnummer des anderen Benutzerkontos}
{---/Leeres JSON-Objekt bei Erfolg}
{2100/Benutzerkonto-Identifikationsnummer ungültig,
2110/Das eigene Benutzerkonto blockiert das angegebene Benutzerkonto}

\apiCommand{unblock-account}
{Hebt die Blockierung des angegebenen Benutzerkontos durch das eigene
Benutzerkonto auf.}
{id/Identifikationsnummer des anderen Benutzerkontos}
{---/Leeres JSON-Objekt bei Erfolg}
{2100/Benutzerkonto-Identifikationsnummer ungültig,
2400/Angegebes Benutzerkonto wird nicht durch das eigene Benutzerkonto
blockiert}

% TODO: Zeit-Toleranz / Annahmen über Synchronität weiter oben spezifizieren
\apiCommand{update-position}
{Aktualisiert die Position des Benutzerkontos.
Der Messzeitpunkt darf aus Sicht der Servers maximal 30 Sekunden in der Zukunft
liegen.}
{latitude/Breitengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
longitude/Längengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
time-measured/Zeitpunkt{,} zu dem die Position gemessen wurde (Angabe in
Unixzeit)}
{---/Leeres JSON-Objekt bei Erfolg}
{2500/Messzeitpunkt liegt zu weit in der Zukunft}

\subsection{Gruppenbeschreibung}\label{sec:groupdesc}

\subsubsection{Oberflächlich}
\apiArgument{
    type/\enquote{group},
    id/Eindeutige Identifikationsnummer der Gruppe{,} mit der diese in
    weiteren Befehlen referenziert werden kann,
    checksum/Prüfsumme der ausführlichen Beschreibung (siehe
    \ref{sec:checksum})}

\subsubsection{Ausführlich}
\apiArgument{
    type/\enquote{group},
    id/Eindeutige Identifikationsnummer der Gruppe{,} mit der diese in
    weiteren Befehlen referenziert werden kann,
    name/Name der Gruppe,
    members/Array an Identifikationsnummern aller Benutzerkonten{,} die
    Mitglied der Gruppe sind,
    events/Array an oberflächlich beschriebenen Verabredungen{,} die in der
    Gruppe erstellt worden sind (siehe \ref{sec:eventdesc}),
    polls/Array an oberflächlich beschriebenen Abstimmungen{,} die in der
    Gruppe erstellt worden sind (siehe \ref{sec:polldesc})
}

\subsection{Benutzerkontobeschreibung}\label{sec:accountdesc}
\apiArgument{type/\enquote{account},
    id/Eindeutige Identifikationsnummer des Benutzerkontos{,} mit der
    dieses in weiteren Befehlen referenziert werden kann,
    user/Benutzername des Kontos
}

\subsection{Verabredungsbeschreibung}\label{sec:eventdesc}

\subsubsection{Oberflächlich}
\apiArgument{type/\enquote{event},
    id/Eindeutige Identifikationsnummer der Verabredung{,} mit der
    diese in weiteren Befehlen referenziert werden kann,
    checksum/Prüfsumme der ausführlichen Beschreibung (siehe
    \ref{sec:checksum})
}

\subsubsection{Ausführlich}
\apiArgument{type/\enquote{event},
    id/Eindeutige Identifikationsnummer der Verabredung{,} mit der
    diese in weiteren Befehlen referenziert werden kann,
    title/Titel der Verabredung,
    creator/Nutzername des Benutzerkontos{,} mit dem die Verabredung erstellt
    wurde,
    time-start/Startzeitpunkt,
    time-end/Endzeitpunkt,
    latitude/Breitengrad{,} auf dem die Verabredung stattfindet
    (Gleitkommazahl),
    longitude/Längengrad{,} auf dem die Verabredung stattfindet
    (Gleitkommazahl),
    participants/Array an Benutzernamen der Benutzerkonten{,} die an der
    Verabredung teilnehmen
}

\subsection{Abstimmungsbeschreibung}\label{sec:polldesc}
% TODO: Split in oberflächlich und ausführlich
\apiArgument{
    type/\enquote{poll},
    id/Eindeutige Identifikationsnummer der Abstimmung{,} mit der diese in
    weiteren Befehlen referenziert werden kann,
    question/Frage{,} über dessen Antwort abgestimmt wird,
    multi-choice/Boolscher Wert{,} der angibt{,} ob ein Nutzer für mehrere
    Optionen stimmen kann,
    options/Array an Beschreibungen von Abstimmungsoptionen{,} die Teil dieser
    Abstimmung sind
}

\subsection{Abstimmungsoptionsbeschreibung}\label{sec:polloptiondesc}
\apiArgument{
    type/\enquote{poll-option},
    id/Eindeutige Identifikationsnummer der Abstimmungsoption{,} mit der diese
    in weiteren Befehlen referenziert werden kann,
    latitude/Breitengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
    longitude/Längengrad der vorgeschlagenen Position (Angabe als Dezimalgrad),
    time-start/Vorgeschlagener Startzeitpunkt (Angabe in Unixzeit),
    time-end/Vorgeschlagener Endzeitpunkt (Angabe in Unixzeit),
    supporters/Array an Identifikationsnummern der Benutzerkonten{,} die
    momentan für diese Options stimmen.
}

\subsection{Prüfsummen für ausführliche Beschreibungen}\label{sec:checksum}
\newcommand{\hashAlg}{MD5}
Um unnötige ausführliche Übertragungen zu vermeiden beinhalten oberflächliche
Beschreibungen Prüfsummen der zum selben Objekt gehörenden ausführlichen
Beschreibung.
Der Client ist somit in der Lage, festzustellen, ob seine lokalen Datensätze
mit denen des Servers übereinstimmen, ohne die Datensätze erneut anfordern zu
müssen.

\par Zur Berechnung der Prüfsummen wird der \hashAlg-Algorithmus verwendet.

\par Da es mehrere unterschiedliche, aber äquivalente JSON-Darstellungen für
eine ausführliche Beschreibung gibt, müssen diese vor Eingabe an den
\hashAlg-Algorithmus in eine normalisierte Form gebracht werden.

\par \textit{Hinweis: In dem folgenden Absatz bezeichnen Ziffern nicht etwa die
ASCII-Ziffern \enquote{0} bis \enquote{9} mit den Werten 48 bis 57, sondern die
nicht darstellbaren Steuerzeichen mit den Werten 0 bis 9.}\\
JSON-Objekte werden mit einer 1 begonnen und mit einer 3 beendet.
Eigenschaften dieser JSON-Objekte werden mit einer 2 statt einem Komma
getrennt.
Die Eigenschaften werden gemäß der in den Beschreibungsspezifikationen
aufgeführten Reihenfolgen sortiert.
JSON-Arrays werden mit einer 4 begonnen und mit einer 6 beendet.
Elemente dieser JSON-Arrays werden mit einer 5 statt mit einem Komma getrennt.
In JSON-Arrays von Beschreibungen kommen lediglich Beschreibungen anderer
Objekte vor. Diese werden aufsteigend nach ihren IDs sortiert.

Alle JSON-Objekteigenschaften werden ohne Schlüssel, Doppelpunkte, geschwungene
Klammern und zusätzliche Leerzeichen oder Zeilenumbrüche konkateniert.
Alle JSON-Arrayelemente werden ohne eckige Klammern und zusätzliche
Leerzeichen oder Zeilenumbrüche konkateniert.
Die doppelten Anführungszeichen um Zeichenketten werden entfernt.
Da alle sechs Trennzeichen nur als Escape-Sequenzen, nicht aber direkt im
JSON-Format vorkommen können\footnote{Vgl. \enquote{RFC 7159}, Kapitel 7
\enquote{Strings}, \url{https://tools.ietf.org/html/rfc7159}} ist diese
Darstellung eindeutig.

% TODO: Update example
\par Im folgenden beispielhaft eine Verabredung mit folgenden Details:
\begin{itemize}
    \item Besitzt die ID 12
    \item Trägt den Titel \enquote{Beispielverabredung 1010}
    \item Erstellt vom Benutzerkonto mit ID 200
    \item Beginnt am 01. Januar 2018 um 00:00:00.000
    \item Endet am 03. Januar 2018 um 18:30:00.000
    \item Findet auf der Position 49.011978 N, 8.416377 E statt
    \item Die Benutzerkonten mit den IDs 200, 3 und 43378 sind als Teilnehmer
        eingetragen
\end{itemize}

Eine mögliche Kodierung der ausführlichen Beschreibung im JSON-Format kann wie
folgt aussehen:
\begin{lstlisting}[language=json,firstnumber=1]
{   "type": "event",
    "id": 2,
    "title": "Beispielverabredung 1010",
    "creator": 200,
    "time-start": 1514761200000,
    "time-end": 1515000600000,
    "latitude": 49.011978,
    "longitude": 8.416377,
    "participants": [
        {   "type": "account",
            "id": 3,
            "user": "w4rum"
        },
        {   "type": "account",
            "id": 200,
            "user": "notw4rum"
        },
        {   "type": "account",
            "id": 43378,
            "user": "absolutelynotw4rum"
        }
    ]
}
\end{lstlisting}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=1pt] (char) {\scriptsize #1};}}

Die normalisierte Darstellung dieser Verabredung sieht wie folgt aus.
Die Steuerzeichen werden durch \circled{1}, \circled{2}, \circled{3} etc.
dargestellt.\\
\textit{Hinweis: Die Zeilenumbrüche dienen nur der besseren Lesbarkeit und sind
nicht in der normalisierten Darstellung enthalten.}

\begin{lstlisting}[language=norm,firstnumber=1]
(*\circled{1}*)"event"(*\circled{2}*)2(*\circled{2}%
*)"Beispielverabredung 1010"(*\circled{2}*)200(*\circled{2}*)1514761200000
(*\circled{2}*)1515000600000(*\circled{2}*)49.011978(*\circled{2}%
*)8.416377(*\circled{2}*)(*\circled{4}*)(*\circled{1}*)"account"(*\circled{2}%
*)3(*\circled{2}*)"w4rum"(*\circled{2}*)"123abc"
(*\circled{3}*)(*\circled{5}*)(*\circled{1}*)"account"(*\circled{2}*)200(*%
\circled{2}*)"notw4rum"(*\circled{2}*)"blaa"(*\circled{3}\circled{5}%
\circled{1}*)"account"(*\circled{2}*)43378
(*\circled{2}*)"absolutelynotw4rum"(*\circled{2}*)"foobar"(*\circled{3}%
\circled{6}\circled{3}*)
\end{lstlisting}

\par Ein beispielhafter Algorithmus für die Normalisierung ist im folgenden
als Python-Implementierung angegeben:

\pythonexternal{scripts/normalize.py}

\end{document}
